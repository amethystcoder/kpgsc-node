<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../static/common_styles.css">
        <link rel="stylesheet" href="../static/linkCU.css">
        <title><%=title%></title>
        <script>
            window.addEventListener("DOMContentLoaded",(ev)=>{
                changeVideoInputType()
                let linkForm = document.querySelector(".main-link-form")
                linkForm.addEventListener("submit",(ev)=>{
                    ev.preventDefault()
                    let formdata = new FormData(linkForm)
                    fetch("../api/link/create",{
                        method:"POST",
                        body:formdata
                    }).then(Response=>Response.json())
                    .then(body=>{
                        console.log(body)
                        if(body.success){
                            window.location.replace('../link/'+body.message[0].insertId)
                        }
                    })
                    .catch(error=>{console.log(error)})
                })
            })
            function convertHLS(){
                fetch("../api/convert/hls",{
                    method:"POST",
                    body:formdata
                }).then(Response=>Response.json())
                .then(body=>{console.log(body)})
                .catch(error=>{console.log(error)})
            }
            function changeVideoInputType() {
                const linkTypeSelect = document.getElementById("link-select")
                let inputs = [document.getElementById("contains-link-inputs"),document.getElementById("contains-file-inputs"),document.getElementById("contains-ftp-inputs")]
                const SelectTypeValue = linkTypeSelect.value
                for (let index = 0; index < inputs.length; index++) {
                    if(inputs[index].getAttribute("data-name") === SelectTypeValue) inputs[index].style.display = "block"
                    else inputs[index].style.display = "none"
                }
            }
        </script>
    </head>
    <body>
        <div class="side-div">
            <%- include('./sections/nav')%>
        </div>
        <main>
            <%- include('./sections/header')%>
            <form class="main-link-form glass card">
                <h1>Create/Edit Link</h1>
                <span>
                    <label for="title">File Title</label>
                    <br>
                    <input type="text" class="light" placeholder="Enter File Title" name="title" id="title">
                </span>
                <br>
                <div class="link-section">
                    <div>
                        <label for="link-select">How do you want to upload your link?</label>
                        <select name="link_select" id="link-select" class="light" onchange="changeVideoInputType()">
                            <option value="link">Link</option>
                            <option value="upload">Upload</option>
                            <option value="ftp">FTP</option>
                        </select>
                    </div>
                    <div id="contains-link-inputs" data-name="link">
                        <span>
                            <label for="main_link">Main Link</label>
                            <br>
                            <input type="text" class="light" placeholder="Enter Main Link to file" name="main_link" id="main_link">
                        </span>
                        <br>
                        <span>
                            <label for="alt_link">Alternate Link</label>
                            <br>
                            <input type="text" class="light" placeholder="Enter File Alternate Links" name="alt_link" id="alt_link">
                        </span>
                    </div>
                    <div id="contains-file-inputs" data-name="upload">
                        <label for="main_link">Upload Video File</label>
                        <br>
                        <input type="file" class="light" accept=".mp4" name="preview_img" id="preview_img">
                    </div>
                    <div id="contains-ftp-inputs" data-name="ftp">
                        <label for="ip_address">IP Address</label>
                        <br>
                        <input type="text" class="light" placeholder="Ip Address" name="ip_address" id="ip_address">
                        <br>
                        <label for="username">Username</label>
                        <br>
                        <input type="text" class="light" placeholder="Username" name="username" id="username">
                        <br>
                        <label for="password">Password</label>
                        <br>
                        <input type="text" class="light" placeholder="Password" name="password" id="password">
                        <br>
                        <label for="file_name">File Name</label>
                        <br>
                        <input type="text" class="light" placeholder="File Name" name="file_name" id="file_name">
                    </div>
                </div>
                <br>
                <span>
                    <label for="subtitles">Subtitle File</label>
                    <br>
                    <input type="file" class="light" accept=".srt,.ttml,.xml,.vtt" id="subtitles" name="subtitles">
                </span>
                <br>
                <span>
                    <label for="preview_img">Preview Image</label>
                    <br>
                    <input type="file" class="light" accept=".png,.jpg" name="preview_img" id="preview_img">
                </span>
                <button>Submit</button>
            </form>
        </main>
    </body>
</html>